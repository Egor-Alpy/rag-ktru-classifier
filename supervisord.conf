# Останавливаем supervisord
pkill supervisord

# Создаем скрипт запуска
cat > /start-services.sh << 'EOF'
#!/bin/bash

# Запускаем Qdrant в фоне
/usr/local/bin/qdrant > /var/log/qdrant.log 2>&1 &
echo "Qdrant запущен"

# Даем Qdrant время на запуск
sleep 5

# Запускаем сервис embedding с правильным импортом
cd /embeddings
PYTHONPATH=/embeddings python -m uvicorn app.main:app --host 0.0.0.0 --port 8080 > /var/log/embedding.log 2>&1 &
echo "Сервис embedding запущен"

# Запускаем сервис LLM с правильным импортом
cd /llm
PYTHONPATH=/llm python -m uvicorn app.main:app --host 0.0.0.0 --port 8081 > /var/log/llm.log 2>&1 &
echo "Сервис LLM запущен"

# Запускаем API сервис с правильным импортом
cd /api
PYTHONPATH=/api python -m uvicorn app.main:app --host 0.0.0.0 --port 8000

# На случай, если API сервис завершится, чтобы контейнер не остановился
tail -f /var/log/*.log
EOF

# Делаем скрипт исполняемым
chmod +x /start-services.sh

# Запускаем скрипт
/start-services.sh